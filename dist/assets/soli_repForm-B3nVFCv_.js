import{y as ut,H as b,a4 as mt,D as _t,a2 as T,E as pt,o as i,c as m,b as s,w as r,a as e,d as _,t as c,z as p,F as y,s as V,k as C,x as L,ab as M,ac as P,a3 as ft,P as bt,Q as ht}from"./index-CUBqpQjk.js";import{a as vt,u as Dt}from"./soli_rep-B5fc7eps.js";import{v as G}from"./validateText-UQqnbmko.js";import{B as xt}from"./BaseBreadcrumb-4MIjbQwQ.js";import{V as g,a as w}from"./VRow-De8gMS49.js";import{V as gt}from"./VAlert-DlDT2AAT.js";import{V as yt}from"./VDialog-BritogP2.js";import{V as Vt,a as Ct,b as wt,c as kt}from"./VCard-B5JACPL-.js";import{V as It}from"./VContainer-BxvF_pwG.js";import{V as B}from"./VTextField-DvwW7kBo.js";import{V as Et}from"./VAutocomplete-DjHg-wst.js";import{V as Rt}from"./VSpacer-D0J7wQQ_.js";import{V as D}from"./VBtn-Bwlw_S26.js";import{V as Bt,a as q,b as H,c as J}from"./VExpansionPanel-CQEXVLf_.js";import{V as Q}from"./VTable-fMMFAG9t.js";import{V as St}from"./VProgressCircular-D0IBnh0x.js";import{_ as Nt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useRender-DUD5GNME.js";import"./router-DjP1fb63.js";import"./VAvatar-DCozc2c4.js";import"./transition-7eeLtsO5.js";import"./VOverlay-ZufbB-oQ.js";import"./forwardRefs-D3j0TLhE.js";import"./lazy-BqTskM4N.js";import"./scopeId-BvaqpV40.js";import"./dialog-transition-BmxFGc2r.js";import"./VField-CAUvKyXj.js";import"./index-CBT7dlbo.js";import"./VLabel-cMv036s0.js";import"./VInput-a6OhgCb3.js";import"./VSelect-Y5UkN40p.js";import"./VList-ClDiqBX_.js";import"./ssrBoot-TGepEb6s.js";import"./VDivider-BKsbfY-L.js";import"./VMenu-Cw996tyh.js";import"./resizeObserver-Dy93hC7S.js";import"./VCheckboxBtn-Ct_gEblA.js";import"./VSelectionControl-Dee3CKWd.js";import"./VChip-B4X-ZzT8.js";import"./VSlideGroup-Bt6gprAW.js";import"./group-C0-37VYq.js";import"./filter-CojnhgC1.js";const l=S=>(bt("data-v-9859a185"),S=S(),ht(),S),Tt={style:{display:"flex","justify-content":"space-between"}},Ot=l(()=>e("b",null,"PLACA :",-1)),Ft={class:"text-primary"},Pt=l(()=>e("b",null,"CHASIS :",-1)),Ut={class:"text-primary"},At=l(()=>e("b",null,"TIPO :",-1)),$t={class:"text-primary"},zt={style:{display:"flex","justify-content":"space-between"}},jt=l(()=>e("b",null,"MARCA :",-1)),Lt={class:"text-primary"},Mt=l(()=>e("b",null,"COLOR :",-1)),Gt={class:"text-primary"},qt=l(()=>e("b",null,"FECHA DE INGRESO :",-1)),Ht={class:"text-primary"},Jt={style:{display:"flex","justify-content":"space-between"}},Qt=l(()=>e("b",null,"CONDUCTOR :",-1)),Kt={class:"text-primary"},Wt=l(()=>e("b",null,"CEL :",-1)),Xt={class:"text-primary"},Yt=l(()=>e("b",null,"PRE - DIAGNOSTICO :",-1)),Zt={class:"text-primary"},te=l(()=>e("span",{class:"text-h5"},"Información del Repuesto",-1)),ee={key:0,class:"v-messages font-weight-black px-2 py-2"},oe=l(()=>e("div",{class:"v-messages__message text-error"}," El campo es requerido ",-1)),ae=[oe],se={key:0,class:"v-messages font-weight-black px-2 py-2"},re=l(()=>e("div",{class:"v-messages__message text-error"}," El campo es requerido ",-1)),ne=[re],le=l(()=>e("th",{class:"text-center"},"N° ",-1)),ie=l(()=>e("th",{class:"text-center"},[e("b",null," Repuesto")],-1)),de=l(()=>e("th",{class:"text-center"},[e("b",null," Cantidad")],-1)),ce=l(()=>e("th",{class:"text-center"},[e("b",null," Unidad")],-1)),ue=l(()=>e("th",{class:"text-center"},[e("b",null," Costo")],-1)),me=l(()=>e("th",{class:"text-center"},[e("b",null," Observación")],-1)),_e=l(()=>e("th",{class:"text-center"},[e("b",null," Entregado")],-1)),pe=l(()=>e("th",{class:"text-center"},[e("b",null," Recibido")],-1)),fe={key:0,class:"text-center"},be=l(()=>e("b",null,"Acción",-1)),he=[be],ve={class:"text-center"},De={class:"text-center"},xe={class:"text-center"},ge={class:"text-center"},ye={class:"text-center"},Ve={class:"text-center"},Ce={key:0,class:"text-center"},we={key:1,class:"text-center"},ke={key:2,class:"text-center"},Ie={key:3,class:"text-center"},Ee={key:4,class:"text-center"},Re={key:5,class:"text-center"},Be={key:6,class:"text-center"},Se=l(()=>e("thead",null,[e("tr",null,[e("th",{class:"text-center"},"N° "),e("th",{class:"text-center"},[e("b",null," Repuesto")]),e("th",{class:"text-center"},[e("b",null," Cantidad")]),e("th",{class:"text-center"},[e("b",null," Unidad")]),e("th",{class:"text-center"},[e("b",null," Costo")]),e("th",{class:"text-center"},[e("b",null," Observación")])])],-1)),Ne={class:"text-center"},Te={class:"text-center"},Oe={class:"text-center"},Fe={class:"text-center"},Pe={class:"text-center"},Ue={class:"text-center"},Ae=l(()=>e("td",null,null,-1)),$e=l(()=>e("td",null,null,-1)),ze=l(()=>e("td",null,null,-1)),je=l(()=>e("td",null,null,-1)),Le=l(()=>e("td",{class:"text-center"},[e("b",null,"Total: ")],-1)),Me={class:"text-center"},Ge=ut({__name:"soli_repForm",setup(S){const k=b(!1),x=JSON.parse(localStorage.getItem("user")||"").id_perfil;JSON.parse(localStorage.getItem("user")||"").id_taller;const U=b([0]),I=mt(),E=vt(),v=Dt(),R=b(!1),O=b(!0),F=b(!1),K=b({title:"Solicitud de Repuestos"}),W=b([{text:"Dashboard",disabled:!1,href:"/home"},{text:"Repuestos",disabled:!0,href:"#"}]),A=b(!0),X=b(!1);JSON.parse(localStorage.getItem("user")||"").nombre_perfil;const t=_t({formData:{id_orden:"",id_registro:"",placa_chasis:"",nombre_taller:"",placa:"",chasis:"",marca:"",modelo:"",motor:"",color_ve:"",placas:"",chasis_:"",kilometraje:"",nro_ocupantes:"",observaciones:"",requerimientos:"",tipo_orden:"",nombre_conductor:"",celular_con:"",tipo_man:"",prediagnostico:"",id_mecanico:"",id_vehiculo:"",nombre_completo:"",nombre_accesorio:"",observacion_ac:"",id_accesorio:"",accesorios_orden:[],dato1:"",dato2:"",dato3:"",dato4:"",nombre_dignostico:"",id_trabajo:"",id_tipo_trabajo:"",nombre_trabajo:"",id_diagnostico:"",nombre_diagnostico:"",prueba:"",repuestos:[],id_sis:"",id_filtro:"",cantidad_r:"",unidad_r:"",observacion_r:"",id_Rep:[],id_Rep2:[],id_accesorios_:[],cedula_identidad:"",total_c:"",total:""},formData2:{fuerza:"",nombre_repuesto:"",id_registro:"",id_repuesto:"",id_solicitud:"",cantidad:"",unidad:"",costo:"",observacion:"",precio:"",id_det:"",estado:"",disponible:""}}),$=b([]),Y=b([]),Z=b([]),tt=async()=>{Y.value=await E.gettipo_trabajo(),Z.value=await E.gettipo_mantenimiento(),$.value=await E.getUnidad()},et=async d=>{const a=await E.getbasico(d);t.formData.id_orden=a.id,t.formData.dato1=a.placa,t.formData.dato2=a.chasis,t.formData.nombre_completo=a.nombre_conductor,t.formData.dato3=a.fecha,t.formData.dato4=a.prediagnostigo,t.formData.marca=a.marca,t.formData.kilometraje=a.kilometraje,t.formData.tipo_orden=a.tipo,t.formData.color_ve=a.color,t.formData.prueba=a.prueba,t.formData2.fuerza=a.fuerza},ot=async d=>{const a=await E.verificar_reg(d);Object.keys(a).length>0&&(t.formData.id_registro=a.id_registro)},at=async d=>{t.formData.id_Rep=await v.getsolicitudes(d),t.formData.id_Rep2=await v.getEntregas(d);const a=await v.getEntregas(d);let o=0;for(let u=0;u<a.length;u++)o=o+parseInt(a[u].costo);t.formData.total_c=String(o);const n=await v.getTotal(d);t.formData.total=n.total},h=b([]),z=async d=>{const a=await v.getID(d);if(t.formData2.id_registro=a.id,t.formData2.id_repuesto=a.id_tipo_repuesto,t.formData2.id_solicitud=a.id_solicitud,t.formData2.nombre_repuesto=a.nombre_repuesto,t.formData2.cantidad=a.cantidad,t.formData2.unidad=a.unidad,t.formData2.precio=a.precio,t.formData2.id_det=a.id_det,t.formData2.estado=a.entregado,t.formData2.disponible=a.can_rep,parseInt(a.costo)>0)t.formData2.costo=a.costo;else if(parseInt(t.formData2.disponible)>0||parseInt(a.costo)==0){h.values=await v.getPrecio(t.formData2.id_repuesto);let o=parseInt(t.formData2.cantidad),n=0,u=0;if(h.values.length>0)for(let f=0;f<h.values.length;f++)h.values[f].entregado>0?(u=parseInt(h.values[f].cantidad)-parseInt(h.values[f].entregado),u==o?o>0&&(n=n+o*parseInt(h.values[f].precio_u),o=Math.max(o-u,0)):u>parseInt(t.formData2.cantidad)?o>0&&(n=n+parseInt(t.formData2.cantidad)*parseInt(h.values[f].precio_u),o=Math.max(o-o,0)):o>0&&(n=n+u*parseInt(h.values[f].precio_u),o=Math.max(o-u,0)),t.formData2.costo=String(n)):(parseInt(t.formData2.cantidad)==o&&o>0&&(n=n+o*parseInt(h.values[f].precio_u),o=Math.max(o-u,0)),parseInt(t.formData2.cantidad)>o?(n=n+parseInt(t.formData2.cantidad)*parseInt(h.values[f].precio_u),o=Math.max(o-o,0)):(n=n+u*parseInt(h.values[f].precio_u),o=Math.max(o-u,0)),t.formData2.costo=String(n));else t.formData2.costo=""}else t.formData2.costo="";k.value=!0},st=()=>{const d=parseFloat(t.formData2.cantidad)||0,a=parseFloat(t.formData2.precio)||0;t.formData2.costo=(d*a).toFixed(2)},rt=()=>{ft.push({name:"ordenList"})},nt=async d=>{await v.minutesReport(d)},j=async()=>{R.value=!0,await lt(),O.value&&(F.value=!0,t.formData.id_orden!="0"&&(k.value=!1,T.fire({title:"¿Estás seguro?",text:"Verifica que la información registrada sea correcta",icon:"warning",showCancelButton:!0,cancelButtonColor:"#FA896B",confirmButtonColor:"#5D87FF",cancelButtonText:"No, volver",confirmButtonText:"Si, actualizar"}).then(async d=>{if(d.isConfirmed){const{ok:a,message:o}=await v.updateRepID(t.formData2),n=a?"success":"error";N.fire({icon:n,title:o})}window.location.reload()})),F.value=!1)},lt=async()=>{O.value=!0,(!t.formData2.cantidad||!t.formData2.unidad||!t.formData2.costo)&&(O.value=!1)},it=()=>{k.value=!1},N=T.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3,timerProgressBar:!0}),dt=async d=>{const a=await v.getID(d);t.formData2.costo=a.costo,parseFloat(t.formData2.costo)>0?T.fire({text:"¡El proceso no podra ser revertido!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"¡Si, entregar!"}).then(async o=>{if(o.isConfirmed){const{ok:n,message:u}=await v.updateEstado1({id:d}),f=n?"success":"error";N.fire({icon:f,title:u}),window.location.reload()}}):N.fire({icon:"error",title:"Por favor, registre el costo del repuesto antes de continuar."})};function ct(d){T.fire({text:"¿Recibió el repuesto?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"¡Si!"}).then(async a=>{if(a.isConfirmed){const{ok:o,message:n}=await v.updateEstado2({id:d}),u=o?"success":"error";N.fire({icon:u,title:n})}window.location.reload()})}return pt(async()=>{await tt(),I.params.id_orden!="0"&&(await ot(I.params.id_orden),parseInt(t.formData.id_registro)>0&&await at(I.params.id_orden),await et(I.params.id_orden),X.value=!0)}),(d,a)=>(i(),m(y,null,[s(xt,{title:K.value.title,breadcrumbs:W.value},null,8,["title","breadcrumbs"]),s(w,null,{default:r(()=>[s(g,{cols:"12",lg:"12"},{default:r(()=>[s(gt,{variant:"outlined",type:"warning",border:"top",icon:"$warning",title:"INFORMACIÓN DEL VEHÍCULO",closable:""},{default:r(()=>[e("div",Tt,[e("div",null,[Ot,_(),e("span",Ft,c(t.formData.dato1),1)]),e("div",null,[Pt,_(),e("span",Ut,c(t.formData.dato2),1)]),e("div",null,[At,_(),e("span",$t,c(t.formData.tipo_orden),1)])]),e("div",zt,[e("div",null,[jt,_(),e("span",Lt,c(t.formData.marca),1)]),e("div",null,[Mt,_(),e("span",Gt,c(t.formData.color_ve),1)]),e("div",null,[qt,_(),e("span",Ht,c(t.formData.dato3),1)])]),e("div",Jt,[e("div",null,[Qt,_(),e("span",Kt,c(t.formData.nombre_completo),1)]),e("div",null,[Wt,_(),e("span",Xt,c(t.formData.dato3),1)]),e("div",null,[Yt,_(),e("span",Zt,c(t.formData.dato4),1)])])]),_:1})]),_:1})]),_:1}),s(w,null,{default:r(()=>[s(yt,{modelValue:k.value,"onUpdate:modelValue":a[12]||(a[12]=o=>k.value=o),"max-width":"1000px"},{default:r(()=>[s(Vt,null,{default:r(()=>[s(Ct,{class:"pa-2 bg-success"},{default:r(()=>[te]),_:1}),s(wt,null,{default:r(()=>[s(It,null,{default:r(()=>[s(w,null,{default:r(()=>[s(g,{cols:"12",md:"4"},{default:r(()=>[s(B,{modelValue:t.formData2.nombre_repuesto,"onUpdate:modelValue":a[0]||(a[0]=o=>t.formData2.nombre_repuesto=o),label:"Repuesto",readonly:""},null,8,["modelValue"])]),_:1}),s(g,{cols:"12",md:"3"},{default:r(()=>[s(B,{onInput:a[1]||(a[1]=o=>(st(),t.formData2.cantidad)),modelValue:t.formData2.cantidad,"onUpdate:modelValue":a[2]||(a[2]=o=>t.formData2.cantidad=o),label:"Cantidad",type:"number",min:1},null,8,["modelValue"])]),_:1}),s(g,{cols:"12",md:"3"},{default:r(()=>[s(Et,{variant:"outlined",label:"Unidad",color:"primary","hide-details":"",items:$.value,modelValue:t.formData2.unidad,"onUpdate:modelValue":a[3]||(a[3]=o=>t.formData2.unidad=o),"no-data-text":"No existe más opciones para seleccionar","item-value":"nombre_unidad","item-title":"nombre_unidad",onInput:a[4]||(a[4]=o=>t.formData2.unidad=p(G)(t.formData2.unidad.toUpperCase()))},null,8,["items","modelValue"])]),_:1}),s(g,{cols:"12",md:"2"},{default:r(()=>[p(x)==1||p(x)==2?(i(),m(y,{key:0},[s(B,{modelValue:t.formData2.costo,"onUpdate:modelValue":a[5]||(a[5]=o=>t.formData2.costo=o),"min:0":"",label:"Precio Unitario",type:"number",error:R.value&&!t.formData2.costo},null,8,["modelValue","error"]),R.value&&!t.formData2.costo?(i(),m("div",ee,ae)):V("",!0)],64)):(i(),m(y,{key:1},[s(B,{modelValue:t.formData2.costo,"onUpdate:modelValue":a[6]||(a[6]=o=>t.formData2.costo=o),"min:0":"",label:"Costo",type:"number",error:R.value&&!t.formData2.costo,readonly:""},null,8,["modelValue","error"]),R.value&&!t.formData2.costo?(i(),m("div",se,ne)):V("",!0)],64))]),_:1}),s(g,{cols:"12",md:"12"},{default:r(()=>[s(B,{modelValue:t.formData2.observacion,"onUpdate:modelValue":a[7]||(a[7]=o=>t.formData2.observacion=o),label:"Observación",type:"text",onInput:a[8]||(a[8]=o=>t.formData2.observacion=p(G)(t.formData2.observacion.toUpperCase()))},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),s(kt,null,{default:r(()=>[s(Rt),s(D,{color:"error",variant:"flat",dark:"",onClick:a[9]||(a[9]=o=>it())},{default:r(()=>[_(" Cancel ")]),_:1}),t.formData2.estado=="RECIBIDO"&&(p(x)==1||p(x)==2)?(i(),C(D,{key:0,color:"success",variant:"flat",dark:"",onClick:a[10]||(a[10]=o=>j())},{default:r(()=>[_(" Guardar ")]),_:1})):(i(),C(D,{key:1,color:"primary",variant:"flat",dark:"",onClick:a[11]||(a[11]=o=>j())},{default:r(()=>[_(" Guardar ")]),_:1}))]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(Bt,{modelValue:U.value,"onUpdate:modelValue":a[13]||(a[13]=o=>U.value=o)},{default:r(()=>[s(q,{elevation:"10",class:"mt-3"},{default:r(()=>[s(H,{class:"text-h6"},{default:r(()=>[_("Solicitud de Repuestos")]),_:1}),s(J,{class:"mt-4"},{default:r(()=>[s(w,null,{default:r(()=>[t.formData.id_Rep.length>0?(i(),C(g,{key:0,cols:"12",md:"12"},{default:r(()=>[s(Q,{density:"compact"},{default:r(()=>[e("thead",null,[e("tr",null,[le,ie,de,ce,ue,me,_e,pe,A.value?(i(),m("th",fe,he)):V("",!0)])]),e("tbody",null,[(i(!0),m(y,null,L(t.formData.id_Rep,(o,n)=>(i(),m("tr",{key:n},[e("td",ve,c(n+1),1),e("td",De,c(o.nombre_repuesto),1),e("td",xe,c(o.cantidad),1),e("td",ge,c(o.unidad),1),e("td",ye,c(o.costo),1),e("td",Ve,c(o.observacion),1),o.entregado==="PENDIENTE"?(i(),m("td",Ce,[s(D,{class:"mr-1",size:"x-small",title:"Entregar repuesto",height:"25",width:"25",color:"success",text:"hola",onClick:u=>dt(o.id)},{default:r(()=>[s(p(M),{style:{cursor:"pointer"}})]),_:2},1032,["onClick"])])):(i(),m("td",we,"ENTREGADO ")),o.recibido==="PENDIENTE"?(i(),m("td",ke,[s(D,{size:"small",title:"Recibir repuesto",height:"25",width:"25",color:"warning",text:"hola",onClick:u=>ct(o.id)},{default:r(()=>[s(p(M),{style:{cursor:"pointer"}})]),_:2},1032,["onClick"])])):(i(),m("td",Ie,"ENTREGADO ")),o.entregado==="PENDIENTE"&&(p(x)==1||p(x)==2||p(x)==5)?(i(),m("td",Ee,[s(D,{class:"mr-1",size:"x-small",title:"Editar",height:"25",width:"25",color:"primary",text:"hola",onClick:u=>z(o.id)},{default:r(()=>[s(p(P),{style:{cursor:"pointer"}})]),_:2},1032,["onClick"])])):o.entregado==="RECIBIDO"&&(p(x)==1||p(x)==2)?(i(),m("td",Re,[s(D,{class:"mr-1",size:"x-small",title:"Editar",height:"25",width:"25",color:"success",text:"hola",onClick:u=>z(o.id)},{default:r(()=>[s(p(P))]),_:2},1032,["onClick"])])):(i(),m("td",Be,[s(D,{class:"mr-1",size:"x-small",title:"Editar",height:"25",width:"25",color:"",text:"hola"},{default:r(()=>[s(p(P))]),_:1})]))]))),128))])]),_:1})]),_:1})):V("",!0)]),_:1})]),_:1})]),_:1}),s(q,{elevation:"10",class:"mt-3"},{default:r(()=>[s(H,{class:"text-h6"},{default:r(()=>[_("Repuestos entregados")]),_:1}),s(J,{class:"mt-4"},{default:r(()=>[s(w,null,{default:r(()=>[t.formData.id_Rep2.length>0?(i(),C(g,{key:0,cols:"12",md:"12"},{default:r(()=>[s(Q,{density:"compact"},{default:r(()=>[Se,e("tbody",null,[(i(!0),m(y,null,L(t.formData.id_Rep2,(o,n)=>(i(),m("tr",{key:n},[e("td",Ne,c(n+1),1),e("td",Te,c(o.nombre_repuesto),1),e("td",Oe,c(o.cantidad),1),e("td",Fe,c(o.unidad),1),e("td",Pe,c(o.costo),1),e("td",Ue,c(o.observacion),1)]))),128)),e("tr",null,[Ae,$e,ze,je,Le,e("td",Me,c(t.formData.total_c)+" Bs.",1)])])]),_:1})]),_:1})):V("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),s(w,null,{default:r(()=>[s(g,{cols:"12",class:"text-lg-left pt-5"},{default:r(()=>[F.value?(i(),C(D,{key:1,color:"primary",disabled:""},{default:r(()=>[s(St,{indeterminate:"",color:"white",class:"mr-2"}),_(" Enviando... ")]),_:1})):(i(),m(y,{key:0},[s(D,{color:"error",class:"mr-3",onClick:a[14]||(a[14]=o=>rt())},{default:r(()=>[_("Volver")]),_:1}),t.formData.total=="0"?(i(),C(D,{key:0,color:"success",class:"mr-10",onClick:a[15]||(a[15]=o=>nt(p(I).params.id_orden))},{default:r(()=>[t.formData.id_registro!="0"&&A.value?(i(),m(y,{key:0},[_(" Imprimir ")],64)):V("",!0)]),_:1})):V("",!0)],64))]),_:1})]),_:1})],64))}}),Oo=Nt(Ge,[["__scopeId","data-v-9859a185"]]);export{Oo as default};
