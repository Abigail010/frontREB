import{y as ut,H as v,a4 as mt,D as _t,a2 as T,E as pt,o as i,c as m,b as s,w as r,a as e,d as p,t as u,z as f,F as y,s as V,k as C,x as L,ab as M,ac as P,a3 as ft,r as vt,P as bt,Q as ht}from"./index-Buq65buf.js";import{a as Dt,u as xt}from"./soli_rep-bGFLqMrS.js";import{v as G}from"./validateText-UQqnbmko.js";import{B as gt}from"./BaseBreadcrumb-BUjUSeql.js";import{V as g,a as R}from"./VRow-Ctz1qQoW.js";import{V as yt}from"./VAlert-BJnpSD-J.js";import{V as Vt}from"./VDialog-Bqb98gRn.js";import{V as Ct,a as wt,b as kt,c as It}from"./VCard-DYx3ZWBV.js";import{V as Et}from"./VContainer-m4CJSWvE.js";import{V as B}from"./VTextField-Ck2WlqEn.js";import{V as Rt}from"./VAutocomplete-CbjURqPs.js";import{V as Bt}from"./VSpacer-CCZWhvvW.js";import{V as D}from"./VBtn-78ZGxu3p.js";import{V as St,a as q,b as H,c as J}from"./VExpansionPanel-t9Xlir-2.js";import{V as Q}from"./VTable-CpX0WyJs.js";import{V as Nt}from"./VProgressCircular-5aNpqKQU.js";import{_ as Tt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useRender-BxYPdWix.js";import"./router-BUAsRsjo.js";import"./VAvatar-DnqmwHRx.js";import"./transition-B72dfbUm.js";import"./VOverlay-BKbQgHv6.js";import"./forwardRefs-D3j0TLhE.js";import"./lazy-B33KSTCg.js";import"./scopeId-3T0RsHAR.js";import"./dialog-transition-9GmGLlaY.js";import"./VField-FB0ObzHG.js";import"./index-BR_FMKrs.js";import"./VLabel-Q0nQNgOl.js";import"./VInput-DW8trHrA.js";import"./VSelect-AWVCrat9.js";import"./VList-DWEkCzxE.js";import"./ssrBoot-J2Isbuk5.js";import"./VDivider-CrauPodZ.js";import"./VMenu-Vw07ipyt.js";import"./resizeObserver-BmQKPLvZ.js";import"./VCheckboxBtn-TAC0gRQb.js";import"./VSelectionControl-BcfiU6xa.js";import"./VChip-vQfLyUmr.js";import"./VSlideGroup-BbB4uZJz.js";import"./group-Db2nUOtn.js";import"./filter-Can5VoxW.js";const l=S=>(bt("data-v-471555c1"),S=S(),ht(),S),Ot={style:{display:"flex","justify-content":"space-between"}},Ft=l(()=>e("b",null,"PLACA :",-1)),Pt={class:"text-primary"},Ut=l(()=>e("b",null,"CHASIS :",-1)),At={class:"text-primary"},$t=l(()=>e("b",null,"TIPO :",-1)),zt={class:"text-primary"},jt={style:{display:"flex","justify-content":"space-between"}},Lt=l(()=>e("b",null,"MARCA :",-1)),Mt={class:"text-primary"},Gt=l(()=>e("b",null,"COLOR :",-1)),qt={class:"text-primary"},Ht=l(()=>e("b",null,"FECHA DE INGRESO :",-1)),Jt={class:"text-primary"},Qt={style:{display:"flex","justify-content":"space-between"}},Kt=l(()=>e("b",null,"CONDUCTOR :",-1)),Wt={class:"text-primary"},Xt=l(()=>e("b",null,"CEL :",-1)),Yt={class:"text-primary"},Zt=l(()=>e("b",null,"PRE - DIAGNOSTICO :",-1)),te={class:"text-primary"},ee=l(()=>e("span",{class:"text-h5"},"Información del Repuesto",-1)),oe={key:0,class:"v-messages font-weight-black px-2 py-2"},ae=l(()=>e("div",{class:"v-messages__message text-error"}," El campo es requerido ",-1)),se=[ae],re={key:0,class:"v-messages font-weight-black px-2 py-2"},ne=l(()=>e("div",{class:"v-messages__message text-error"}," El campo es requerido ",-1)),le=[ne],ie=l(()=>e("th",{class:"text-center"},"N° ",-1)),de=l(()=>e("th",{class:"text-center"},[e("b",null," Repuesto")],-1)),ce=l(()=>e("th",{class:"text-center"},[e("b",null," Cantidad")],-1)),ue=l(()=>e("th",{class:"text-center"},[e("b",null," Unidad")],-1)),me=l(()=>e("th",{class:"text-center"},[e("b",null," Costo")],-1)),_e=l(()=>e("th",{class:"text-center"},[e("b",null," Observación")],-1)),pe=l(()=>e("th",{class:"text-center"},[e("b",null," Entregado")],-1)),fe=l(()=>e("th",{class:"text-center"},[e("b",null," Recibido")],-1)),ve={key:0,class:"text-center"},be=l(()=>e("b",null,"Acción",-1)),he=[be],De={class:"text-center"},xe={class:"text-center"},ge={class:"text-center"},ye={class:"text-center"},Ve={class:"text-center"},Ce={class:"text-center"},we={key:0,class:"text-center"},ke={key:1,class:"text-center"},Ie={key:2,class:"text-center"},Ee={key:3,class:"text-center"},Re={key:4,class:"text-center"},Be={key:5,class:"text-center"},Se={key:6,class:"text-center"},Ne=l(()=>e("thead",null,[e("tr",null,[e("th",{class:"text-center"},"N° "),e("th",{class:"text-center"},[e("b",null," Repuesto")]),e("th",{class:"text-center"},[e("b",null," Cantidad")]),e("th",{class:"text-center"},[e("b",null," Unidad")]),e("th",{class:"text-center"},[e("b",null," Costo")]),e("th",{class:"text-center"},[e("b",null," Observación")])])],-1)),Te={class:"text-center"},Oe={class:"text-center"},Fe={class:"text-center"},Pe={class:"text-center"},Ue={class:"text-center"},Ae={class:"text-center"},$e=l(()=>e("td",null,null,-1)),ze=l(()=>e("td",null,null,-1)),je=l(()=>e("td",null,null,-1)),Le=l(()=>e("td",null,null,-1)),Me=l(()=>e("td",{class:"text-center"},[e("b",null,"Total: ")],-1)),Ge={class:"text-center"},qe=ut({__name:"soli_repForm",setup(S){const w=v(!1),x=JSON.parse(localStorage.getItem("user")||"").id_perfil;JSON.parse(localStorage.getItem("user")||"").id_taller;const U=v([0]),k=mt(),I=Dt(),h=xt(),E=v(!1),O=v(!0),F=v(!1),K=v({title:"Solicitud de Repuestos"}),W=v([{text:"Dashboard",disabled:!1,href:"/home"},{text:"Repuestos",disabled:!0,href:"#"}]),A=v(!0),X=v(!1);JSON.parse(localStorage.getItem("user")||"").nombre_perfil;const t=_t({formData:{id_orden:"",id_registro:"",placa_chasis:"",nombre_taller:"",placa:"",chasis:"",marca:"",modelo:"",motor:"",color_ve:"",placas:"",chasis_:"",kilometraje:"",nro_ocupantes:"",observaciones:"",requerimientos:"",tipo_orden:"",nombre_conductor:"",celular_con:"",tipo_man:"",prediagnostico:"",id_mecanico:"",id_vehiculo:"",nombre_completo:"",nombre_accesorio:"",observacion_ac:"",id_accesorio:"",accesorios_orden:[],dato1:"",dato2:"",dato3:"",dato4:"",nombre_dignostico:"",id_trabajo:"",id_tipo_trabajo:"",nombre_trabajo:"",id_diagnostico:"",nombre_diagnostico:"",prueba:"",repuestos:[],id_sis:"",id_filtro:"",cantidad_r:"",unidad_r:"",observacion_r:"",id_Rep:[],id_Rep2:[],id_accesorios_:[],cedula_identidad:"",total_c:"",total:""},formData2:{fuerza:"",nombre_repuesto:"",id_registro:"",id_repuesto:"",id_solicitud:"",cantidad:"",unidad:"",costo:"",observacion:"",precio:"",id_det:"",estado:"",disponible:""}}),$=v([]),Y=v([]),Z=v([]),tt=async()=>{Y.value=await I.gettipo_trabajo(),Z.value=await I.gettipo_mantenimiento(),$.value=await I.getUnidad()},et=async c=>{const o=await I.getbasico(c);t.formData.id_orden=o.id,t.formData.dato1=o.placa,t.formData.dato2=o.chasis,t.formData.nombre_completo=o.nombre_conductor,t.formData.dato3=o.fecha,t.formData.dato4=o.prediagnostigo,t.formData.marca=o.marca,t.formData.kilometraje=o.kilometraje,t.formData.tipo_orden=o.tipo,t.formData.color_ve=o.color,t.formData.prueba=o.prueba,t.formData2.fuerza=o.fuerza},ot=async c=>{const o=await I.verificar_reg(c);Object.keys(o).length>0&&(t.formData.id_registro=o.id_registro)},at=async c=>{t.formData.id_Rep=await h.getsolicitudes(c),t.formData.id_Rep2=await h.getEntregas(c);const o=await h.getEntregas(c);let n=0;for(let d=0;d<o.length;d++)n=n+parseInt(o[d].costo);t.formData.total_c=String(n);const a=await h.getTotal(c);t.formData.total=a.total},b=v([]),z=async c=>{const o=await h.getID(c);if(t.formData2.id_registro=o.id,t.formData2.id_repuesto=o.id_tipo_repuesto,t.formData2.id_solicitud=o.id_solicitud,t.formData2.nombre_repuesto=o.nombre_repuesto,t.formData2.cantidad=o.cantidad,t.formData2.unidad=o.unidad,t.formData2.precio=o.precio,t.formData2.id_det=o.id_det,t.formData2.estado=o.entregado,t.formData2.disponible=o.can_rep,parseInt(o.costo)>0)t.formData2.costo=o.costo;else if(parseInt(t.formData2.disponible)>0||parseInt(o.costo)==0){b.values=await h.getPrecio(t.formData2.id_repuesto);let n=parseInt(t.formData2.cantidad),a=0,d=0;if(b.values.length>0)for(let _=0;_<b.values.length;_++)b.values[_].entregado>0?(d=parseInt(b.values[_].cantidad)-parseInt(b.values[_].entregado),d==n?n>0&&(a=a+n*parseInt(b.values[_].precio_u),n=Math.max(n-d,0)):d>parseInt(t.formData2.cantidad)?n>0&&(a=a+parseInt(t.formData2.cantidad)*parseInt(b.values[_].precio_u),n=Math.max(n-n,0)):n>0&&(a=a+d*parseInt(b.values[_].precio_u),n=Math.max(n-d,0)),t.formData2.costo=String(a)):(parseInt(t.formData2.cantidad)==n&&n>0&&(a=a+n*parseInt(b.values[_].precio_u),n=Math.max(n-d,0)),parseInt(t.formData2.cantidad)>n?(a=a+parseInt(t.formData2.cantidad)*parseInt(b.values[_].precio_u),n=Math.max(n-n,0)):(a=a+d*parseInt(b.values[_].precio_u),n=Math.max(n-d,0)),t.formData2.costo=String(a));else t.formData2.costo=""}else t.formData2.costo="";w.value=!0},st=()=>{const c=parseFloat(t.formData2.cantidad)||0,o=parseFloat(t.formData2.precio)||0;t.formData2.costo=(c*o).toFixed(2)},rt=()=>{ft.push({name:"ordenList"})},nt=async c=>{await h.minutesReport(c)},j=async()=>{E.value=!0,await lt(),O.value&&(F.value=!0,t.formData.id_orden!="0"&&(w.value=!1,T.fire({title:"¿Estás seguro?",text:"Verifica que la información registrada sea correcta",icon:"warning",showCancelButton:!0,cancelButtonColor:"#FA896B",confirmButtonColor:"#5D87FF",cancelButtonText:"No, volver",confirmButtonText:"Si, actualizar"}).then(async c=>{if(c.isConfirmed){const{ok:o,message:n}=await h.updateRepID(t.formData2),a=o?"success":"error";N.fire({icon:a,title:n})}window.location.reload()})),F.value=!1)},lt=async()=>{O.value=!0,(!t.formData2.cantidad||!t.formData2.unidad||!t.formData2.costo)&&(O.value=!1)},it=()=>{w.value=!1},N=T.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:2e3,timerProgressBar:!0}),dt=async c=>{const o=await h.getID(c);t.formData2.costo=o.costo,parseFloat(t.formData2.costo)>0?T.fire({text:"¡El proceso no podra ser revertido!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"¡Si, entregar!"}).then(async n=>{if(n.isConfirmed){const{ok:a,message:d}=await h.updateEstado1({id:c}),_=a?"success":"error";N.fire({icon:_,title:d}),window.location.reload()}}):N.fire({icon:"error",title:"Por favor, registre el costo del repuesto antes de continuar."})};function ct(c){T.fire({text:"¿Recibió el repuesto?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"¡Si!"}).then(async o=>{if(o.isConfirmed){const{ok:n,message:a}=await h.updateEstado2({id:c}),d=n?"success":"error";N.fire({icon:d,title:a})}window.location.reload()})}return pt(async()=>{await tt(),k.params.id_orden!="0"&&(await ot(k.params.id_orden),parseInt(t.formData.id_registro)>0?await at(k.params.id_orden):console.log("0"),await et(k.params.id_orden),X.value=!0)}),(c,o)=>{const n=vt("v-rom");return i(),m(y,null,[s(gt,{title:K.value.title,breadcrumbs:W.value},null,8,["title","breadcrumbs"]),s(R,null,{default:r(()=>[s(g,{cols:"12",lg:"12"},{default:r(()=>[s(yt,{variant:"outlined",type:"warning",border:"top",icon:"$warning",title:"INFORMACIÓN DEL VEHÍCULO",closable:""},{default:r(()=>[e("div",Ot,[e("div",null,[Ft,p(),e("span",Pt,u(t.formData.dato1),1)]),e("div",null,[Ut,p(),e("span",At,u(t.formData.dato2),1)]),e("div",null,[$t,p(),e("span",zt,u(t.formData.tipo_orden),1)])]),e("div",jt,[e("div",null,[Lt,p(),e("span",Mt,u(t.formData.marca),1)]),e("div",null,[Gt,p(),e("span",qt,u(t.formData.color_ve),1)]),e("div",null,[Ht,p(),e("span",Jt,u(t.formData.dato3),1)])]),e("div",Qt,[e("div",null,[Kt,p(),e("span",Wt,u(t.formData.nombre_completo),1)]),e("div",null,[Xt,p(),e("span",Yt,u(t.formData.dato3),1)]),e("div",null,[Zt,p(),e("span",te,u(t.formData.dato4),1)])])]),_:1})]),_:1})]),_:1}),s(n,null,{default:r(()=>[s(Vt,{modelValue:w.value,"onUpdate:modelValue":o[12]||(o[12]=a=>w.value=a),"max-width":"1000px"},{default:r(()=>[s(Ct,null,{default:r(()=>[s(wt,{class:"pa-2 bg-success"},{default:r(()=>[ee]),_:1}),s(kt,null,{default:r(()=>[s(Et,null,{default:r(()=>[s(R,null,{default:r(()=>[s(g,{cols:"12",md:"4"},{default:r(()=>[s(B,{modelValue:t.formData2.nombre_repuesto,"onUpdate:modelValue":o[0]||(o[0]=a=>t.formData2.nombre_repuesto=a),label:"Repuesto",readonly:""},null,8,["modelValue"])]),_:1}),s(g,{cols:"12",md:"3"},{default:r(()=>[s(B,{onInput:o[1]||(o[1]=a=>(st(),t.formData2.cantidad)),modelValue:t.formData2.cantidad,"onUpdate:modelValue":o[2]||(o[2]=a=>t.formData2.cantidad=a),label:"Cantidad",type:"number",min:1},null,8,["modelValue"])]),_:1}),s(g,{cols:"12",md:"3"},{default:r(()=>[s(Rt,{variant:"outlined",label:"Unidad",color:"primary","hide-details":"",items:$.value,modelValue:t.formData2.unidad,"onUpdate:modelValue":o[3]||(o[3]=a=>t.formData2.unidad=a),"no-data-text":"No existe más opciones para seleccionar","item-value":"nombre_unidad","item-title":"nombre_unidad",onInput:o[4]||(o[4]=a=>t.formData2.unidad=f(G)(t.formData2.unidad.toUpperCase()))},null,8,["items","modelValue"])]),_:1}),s(g,{cols:"12",md:"2"},{default:r(()=>[f(x)==1||f(x)==2?(i(),m(y,{key:0},[s(B,{modelValue:t.formData2.costo,"onUpdate:modelValue":o[5]||(o[5]=a=>t.formData2.costo=a),"min:0":"",label:"Precio Unitario",type:"number",error:E.value&&!t.formData2.costo},null,8,["modelValue","error"]),E.value&&!t.formData2.costo?(i(),m("div",oe,se)):V("",!0)],64)):(i(),m(y,{key:1},[s(B,{modelValue:t.formData2.costo,"onUpdate:modelValue":o[6]||(o[6]=a=>t.formData2.costo=a),"min:0":"",label:"Costo",type:"number",error:E.value&&!t.formData2.costo,readonly:""},null,8,["modelValue","error"]),E.value&&!t.formData2.costo?(i(),m("div",re,le)):V("",!0)],64))]),_:1}),s(g,{cols:"12",md:"12"},{default:r(()=>[s(B,{modelValue:t.formData2.observacion,"onUpdate:modelValue":o[7]||(o[7]=a=>t.formData2.observacion=a),label:"Observación",type:"text",onInput:o[8]||(o[8]=a=>t.formData2.observacion=f(G)(t.formData2.observacion.toUpperCase()))},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),s(It,null,{default:r(()=>[s(Bt),s(D,{color:"error",variant:"flat",dark:"",onClick:o[9]||(o[9]=a=>it())},{default:r(()=>[p(" Cancel ")]),_:1}),t.formData2.estado=="RECIBIDO"&&(f(x)==1||f(x)==2)?(i(),C(D,{key:0,color:"success",variant:"flat",dark:"",onClick:o[10]||(o[10]=a=>j())},{default:r(()=>[p(" Guardar ")]),_:1})):(i(),C(D,{key:1,color:"primary",variant:"flat",dark:"",onClick:o[11]||(o[11]=a=>j())},{default:r(()=>[p(" Guardar ")]),_:1}))]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(St,{modelValue:U.value,"onUpdate:modelValue":o[13]||(o[13]=a=>U.value=a)},{default:r(()=>[s(q,{elevation:"10",class:"mt-3"},{default:r(()=>[s(H,{class:"text-h6"},{default:r(()=>[p("Solicitud de Repuestos")]),_:1}),s(J,{class:"mt-4"},{default:r(()=>[s(R,null,{default:r(()=>[t.formData.id_Rep.length>0?(i(),C(g,{key:0,cols:"12",md:"12"},{default:r(()=>[s(Q,{density:"compact"},{default:r(()=>[e("thead",null,[e("tr",null,[ie,de,ce,ue,me,_e,pe,fe,A.value?(i(),m("th",ve,he)):V("",!0)])]),e("tbody",null,[(i(!0),m(y,null,L(t.formData.id_Rep,(a,d)=>(i(),m("tr",{key:d},[e("td",De,u(d+1),1),e("td",xe,u(a.nombre_repuesto),1),e("td",ge,u(a.cantidad),1),e("td",ye,u(a.unidad),1),e("td",Ve,u(a.costo),1),e("td",Ce,u(a.observacion),1),a.entregado==="PENDIENTE"?(i(),m("td",we,[s(D,{class:"mr-1",size:"x-small",title:"Entregar repuesto",height:"25",width:"25",color:"success",text:"hola",onClick:_=>dt(a.id)},{default:r(()=>[s(f(M),{style:{cursor:"pointer"}})]),_:2},1032,["onClick"])])):(i(),m("td",ke,"ENTREGADO ")),a.recibido==="PENDIENTE"?(i(),m("td",Ie,[s(D,{size:"small",title:"Recibir repuesto",height:"25",width:"25",color:"warning",text:"hola",onClick:_=>ct(a.id)},{default:r(()=>[s(f(M),{style:{cursor:"pointer"}})]),_:2},1032,["onClick"])])):(i(),m("td",Ee,"ENTREGADO ")),a.entregado==="PENDIENTE"&&(f(x)==1||f(x)==2||f(x)==5)?(i(),m("td",Re,[s(D,{class:"mr-1",size:"x-small",title:"Editar",height:"25",width:"25",color:"primary",text:"hola",onClick:_=>z(a.id)},{default:r(()=>[s(f(P),{style:{cursor:"pointer"}})]),_:2},1032,["onClick"])])):a.entregado==="RECIBIDO"&&(f(x)==1||f(x)==2)?(i(),m("td",Be,[s(D,{class:"mr-1",size:"x-small",title:"Editar",height:"25",width:"25",color:"success",text:"hola",onClick:_=>z(a.id)},{default:r(()=>[s(f(P))]),_:2},1032,["onClick"])])):(i(),m("td",Se,[s(D,{class:"mr-1",size:"x-small",title:"Editar",height:"25",width:"25",color:"",text:"hola"},{default:r(()=>[s(f(P))]),_:1})]))]))),128))])]),_:1})]),_:1})):V("",!0)]),_:1})]),_:1})]),_:1}),s(q,{elevation:"10",class:"mt-3"},{default:r(()=>[s(H,{class:"text-h6"},{default:r(()=>[p("Repuestos entregados")]),_:1}),s(J,{class:"mt-4"},{default:r(()=>[s(R,null,{default:r(()=>[t.formData.id_Rep2.length>0?(i(),C(g,{key:0,cols:"12",md:"12"},{default:r(()=>[s(Q,{density:"compact"},{default:r(()=>[Ne,e("tbody",null,[(i(!0),m(y,null,L(t.formData.id_Rep2,(a,d)=>(i(),m("tr",{key:d},[e("td",Te,u(d+1),1),e("td",Oe,u(a.nombre_repuesto),1),e("td",Fe,u(a.cantidad),1),e("td",Pe,u(a.unidad),1),e("td",Ue,u(a.costo),1),e("td",Ae,u(a.observacion),1)]))),128)),e("tr",null,[$e,ze,je,Le,Me,e("td",Ge,u(t.formData.total_c)+" Bs.",1)])])]),_:1})]),_:1})):V("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),s(R,null,{default:r(()=>[s(g,{cols:"12",class:"text-lg-left pt-5"},{default:r(()=>[F.value?(i(),C(D,{key:1,color:"primary",disabled:""},{default:r(()=>[s(Nt,{indeterminate:"",color:"white",class:"mr-2"}),p(" Enviando... ")]),_:1})):(i(),m(y,{key:0},[s(D,{color:"error",class:"mr-3",onClick:o[14]||(o[14]=a=>rt())},{default:r(()=>[p("Volver")]),_:1}),t.formData.total=="0"?(i(),C(D,{key:0,color:"success",class:"mr-10",onClick:o[15]||(o[15]=a=>nt(f(k).params.id_orden))},{default:r(()=>[t.formData.id_registro!="0"&&A.value?(i(),m(y,{key:0},[p(" Imprimir ")],64)):V("",!0)]),_:1})):V("",!0)],64))]),_:1})]),_:1})],64)}}}),Fo=Tt(qe,[["__scopeId","data-v-471555c1"]]);export{Fo as default};
